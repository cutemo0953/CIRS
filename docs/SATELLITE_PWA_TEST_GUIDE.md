# Satellite PWA 測試指南

> 給志工、工作人員、醫護人員的手機 App 測試說明

---

## 什麼是 Satellite PWA？

**Satellite PWA** 是一個手機網頁應用程式，讓您可以：
- 用自己的手機進行報到、發放物資等操作
- 不需要跑回電腦前，在現場就能處理
- 即使網路不穩，操作也會暫存，恢復後自動同步

**就像傳令兵的小筆記本** - 您在現場記錄，資料會自動回傳到指揮中心（Hub）。

---

## 測試前準備

### 需要的設備
- [ ] 一台電腦（運行 Hub / 指揮中心）
- [ ] 一支智慧型手機（Android 或 iPhone）
- [ ] 電腦和手機連接同一個 WiFi 網路

### ⚠️ 重要：首次配對網路要求

**首次配對時，電腦（Hub）和手機必須連接到同一個 WiFi 網路。**

這是因為：
1. 手機掃描 QR Code 後，會連接到電腦的 IP 位址（如 `192.168.1.100`）
2. 如果手機和電腦不在同一個區域網路，將無法連接
3. 配對成功後取得的 Token 有效期為 12 小時

**常見問題**：
- 確認手機沒有使用行動數據（4G/5G）
- 某些公共 WiFi 會隔離設備，建議使用私人 WiFi
- 確認電腦防火牆允許 port 8090 的連線

### 確認 Hub 已啟動
1. 電腦上開啟瀏覽器
2. 前往 `http://localhost:8090/frontend`
3. 看到 CIRS 管理介面 = Hub 已啟動 ✓

---

## 測試流程 A：配對連線

### 步驟 1：管理員產生配對 QR Code

1. 在電腦上登入 CIRS 管理介面
   - 帳號：`admin001`
   - PIN：`1234`

2. 點擊右上角的「**Satellite 配對**」按鈕（或進入設定頁面）

3. 畫面會顯示一個 **QR Code**
   - ⚠️ 此 QR Code **5 分鐘後過期**
   - 過期後需要重新產生

### 步驟 2：手機掃描 QR Code

1. 打開手機的**相機** App（或任何 QR 掃描器）

2. 掃描電腦上的 QR Code

3. 手機會開啟瀏覽器，自動連線到 Hub

4. 看到「**連線成功**」訊息 = 配對完成 ✓

### 預期結果
- [ ] 手機顯示 Satellite PWA 主畫面
- [ ] 顯示 Hub 名稱（如「社區避難中心」）
- [ ] 可以看到目前的收容人數

### 如果失敗
| 問題 | 可能原因 | 解決方法 |
|------|----------|----------|
| 掃描後沒反應 | QR Code 過期 | 請管理員重新產生 |
| 顯示「連線失敗」 | 手機和電腦不在同一個 WiFi | 確認網路連線 |
| 顯示「Token 無效」 | 配對碼已被使用 | 請管理員產生新的 QR Code |

---

## 測試流程 B：人員報到

### 步驟 1：在手機上操作報到

1. 在 Satellite PWA 主畫面，點擊「**報到**」

2. 輸入或掃描人員編號（如 `P0001`）

3. 選擇報到地點（如「休息區」）

4. 點擊「**確認報到**」

### 步驟 2：確認同步成功

1. 畫面顯示「**已同步**」= 成功 ✓

2. 在電腦上的管理介面，檢查：
   - 該人員狀態變成「已報到」
   - 報到時間正確
   - 報到地點正確

### 預期結果
- [ ] 手機顯示報到成功
- [ ] 電腦上可以看到報到記錄
- [ ] 收容人數 +1

---

## 測試流程 C：離線操作（重要！）

> 這個測試確保網路不穩時，操作不會遺失

### 步驟 1：模擬斷網

1. 將手機的 **WiFi 關閉**（或切換到飛航模式）

2. Satellite PWA 上方應該顯示「**離線**」標示

### 步驟 2：離線狀態下操作

1. 執行一次「報到」操作
   - 輸入人員編號
   - 點擊確認

2. 畫面應該顯示：
   - 「**暫存中**」或「**Pending: 1**」
   - 操作已記錄，等待同步

3. 再執行一次「物資發放」操作（如果有）

### 步驟 3：恢復網路，確認同步

1. 將手機的 **WiFi 重新開啟**

2. 等待幾秒鐘（或點擊「**立即同步**」按鈕）

3. 確認：
   - 「Pending」數字變成 0
   - 顯示「**已同步**」

4. 在電腦上確認所有操作都正確記錄

### 預期結果
- [ ] 離線時可以操作，顯示「暫存中」
- [ ] 恢復網路後自動同步
- [ ] 同一筆操作不會重複記錄（冪等性）

---

## 測試流程 D：物資發放

### 步驟 1：選擇物資

1. 在 Satellite PWA，點擊「**發放物資**」

2. 選擇要發放的物資（如「飲用水」）

3. 輸入數量（如「2 瓶」）

4. 點擊「**確認發放**」

### 步驟 2：確認庫存變化

1. 在電腦上的管理介面，查看物資庫存

2. 確認該物資數量已減少

### 預期結果
- [ ] 手機顯示發放成功
- [ ] 電腦上庫存數量正確減少
- [ ] 事件記錄中有發放紀錄

---

## 測試流程 E：iOS 特別測試

> iPhone 用戶請額外測試此流程

### 背景說明
iOS Safari 不支援背景同步，需要特別處理。

### 步驟

1. 使用 iPhone 完成配對

2. 關閉 WiFi，執行 2-3 個操作

3. 確認畫面顯示「**Pending: N**」（N = 暫存數量）

4. 恢復 WiFi

5. **如果沒有自動同步**，點擊「**Sync Now**」按鈕

6. 確認所有操作同步完成

### 預期結果
- [ ] Navbar 顯示 Pending 數量
- [ ] 「Sync Now」按鈕可用
- [ ] 手動同步後資料正確

---

## 常見問題排解

### Q: 配對 QR Code 掃不到？
- 確認 QR Code 沒有過期（5 分鐘）
- 試著調整手機距離或光線
- 請管理員重新產生

### Q: 操作後電腦上沒更新？
- 檢查手機是否顯示「已同步」
- 如果顯示「Pending」，點擊「Sync Now」
- 檢查 WiFi 連線是否正常

### Q: 手機重新開機後需要重新配對嗎？
- **關閉瀏覽器**：需要重新配對
- **僅關閉螢幕**：不需要，Token 仍有效（12 小時內）

### Q: 多人可以同時使用嗎？
- 可以！每支手機獨立配對
- 每個人的操作都會記錄是誰執行的

---

## 測試檢查清單

請在完成測試後，勾選以下項目：

### 基本功能
- [ ] 配對連線成功
- [ ] 可以看到 Hub 狀態
- [ ] 人員報到功能正常
- [ ] 人員退場功能正常

### 離線功能
- [ ] 離線時可以操作
- [ ] 顯示 Pending 數量
- [ ] 恢復網路後自動同步
- [ ] 重複提交不會重複記錄

### 物資功能
- [ ] 可以查看庫存
- [ ] 發放物資功能正常
- [ ] 庫存數量正確更新

### iOS 特別
- [ ] Pending 指示器正常顯示
- [ ] Sync Now 按鈕可用
- [ ] 手動同步正常

---

## 測試回報

如果發現任何問題，請記錄：

1. **問題描述**：發生了什麼？
2. **操作步驟**：您做了什麼操作？
3. **手機型號**：iPhone 15 / Samsung S24 等
4. **瀏覽器**：Safari / Chrome
5. **截圖**：如果可能，請截圖

回報至：[GitHub Issues](https://github.com/cutemo0953/CIRS/issues)

---

*文件版本：v1.1*
*最後更新：2025-12*
