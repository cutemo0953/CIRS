# xIRS Station & Pharmacy PWA Development Specification v2.3

**Version**: 2.3 (Final Merged)
**Date**: 2025-12-22
**Status**: Ready for Development
**Supersedes**: v2.0, v2.2
**Contributors**: Claude, ChatGPT, Gemini

---

## 0. è®Šæ›´æ‘˜è¦ (Change Summary)

| Source | Contribution |
|--------|--------------|
| **v2.0** | Onboarding UX, Task-oriented dashboard |
| **v2.2** | Data sensitivity model, Dual station types, SOAP-Lite |
| **Claude** | Web Crypto over SQLCipher, CERT_UPDATE packet |
| **ChatGPT** | Pairing security (no embedded secrets), patient_ref hardening |
| **Gemini** | Final architecture consolidation |

---

## 1. ç³»çµ±æ¶æ§‹ (Architecture)

### 1.1 é›™ PWA ç­–ç•¥ (Dual PWA Strategy)

**æ±ºç­–ç†ç”±**:
- é¿å…ã€Œæ¨¡å¼åˆ‡æ›ã€é€ æˆç¾å ´èª¤ç”¨
- æ¸›å°‘è³‡å®‰å¤–æº¢ç¯„åœ (Blast Radius)
- ç¬¦åˆ JTBDã€Œä»»å‹™ä¸€ç›®ç­ç„¶ã€åŸå‰‡

| PWA | URL | ä½¿ç”¨è€… | æ ¸å¿ƒä»»å‹™ | è³‡æ–™æ¬Šé™ |
|-----|-----|--------|----------|----------|
| **Supply Station** | `/station/` | ç‰©è³‡å¿—å·¥ã€ç«™é•· | æ”¶è²¨ã€ç™¼æ”¾ã€ç›¤é» | Class C only |
| **Pharmacy Station** | `/pharmacy/` | è—¥å¸« | æ¥æ”¶è™•æ–¹ã€é©—è­‰ã€ç™¼è—¥ | Class B + C |

### 1.2 è³‡æ–™æ•æ„Ÿåº¦åˆ†ç´š (Data Sensitivity Model)

| åˆ†ç´š | å®šç¾© | å…§å®¹ç¯„ä¾‹ | è¦å‰‡ |
|------|------|----------|------|
| **Class A** (PHI) | å¯ç›´æ¥è­˜åˆ¥å€‹äºº | å§“åã€èº«åˆ†è­‰ã€é›»è©±ã€å®Œæ•´ç—…æ­· | ğŸš« **ç¦æ­¢**å­˜åœ¨ä»»ä½• Station/Pharmacy æœ¬åœ°ç«¯ |
| **Class B** (Clinical) | æœ€å°åŒ–è‡¨åºŠè³‡æ–™ | `patient_ref` tokenã€SOAP-Lite | ğŸ”’ Pharmacy å°ˆç”¨ï¼ŒAES-GCM åŠ å¯†å„²å­˜ |
| **Class C** (Ops) | é‹ä½œè³‡æ–™ | ç‰©å“ä»£ç¢¼ã€æ•¸é‡ã€Station IDã€æ™‚é–“æˆ³ | âœ… å…¨ç³»çµ±é€šè¡Œ |

> **é—œéµç´„æŸ**: CIRS/Station çš„ä»»ä½•è³‡æ–™è¡¨éƒ½**ä¸å¾—**å„²å­˜ Class A æˆ– Class B è³‡æ–™ã€‚

### 1.3 å°ˆæ¡ˆçµæ§‹

```
/frontend
â”œâ”€â”€ /station          # Supply Station PWA
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ manifest.json
â”‚   â””â”€â”€ service-worker.js
â”‚
â”œâ”€â”€ /pharmacy         # Pharmacy Station PWA (NEW)
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ manifest.json
â”‚   â””â”€â”€ service-worker.js
â”‚
â””â”€â”€ /shared           # å…±ç”¨æ¨¡çµ„
    â”œâ”€â”€ /js
    â”‚   â”œâ”€â”€ xirs-crypto.js      # WebCrypto wrappers
    â”‚   â”œâ”€â”€ xirs-protocol.js    # Manifest/Report
    â”‚   â”œâ”€â”€ xirs-storage.js     # IndexedDB
    â”‚   â””â”€â”€ xirs-pairing.js     # Pairing flow (NEW)
    â””â”€â”€ /components             # Shared UI components
```

---

## 2. å®‰å…¨é…å°å”è­° (Secure Pairing Protocol)

### 2.1 è¨­è¨ˆåŸå‰‡ (ChatGPT Feedback)

**å•é¡Œ**: åŸè¨­è¨ˆå°‡ `station_secret`ã€`hub_public_key` ç›´æ¥åµŒå…¥ QR Codeã€‚
**é¢¨éšª**: QR æ´©æ¼ = é•·æœŸé‡‘é‘°æ´©æ¼ = æ°¸ä¹…å±å®³ã€‚

**è§£æ±ºæ–¹æ¡ˆ**: QR åƒ…å«çŸ­æœŸé…å°è³‡è¨Šï¼Œé‡‘é‘°é€éå®‰å…¨é€šé“å–å¾—ã€‚

### 2.2 é…å° QR æ ¼å¼ (v2.3)

```json
{
  "type": "STATION_PAIR_INVITE",
  "ver": 1,
  "hub_url": "https://hub.example.com",
  "pairing_code": "A3X9K2",           // 6-char, expires in 10 min
  "station_id": "STATION-PARK",       // Pre-assigned ID
  "station_type": "SUPPLY"            // or "PHARMACY"
}
```

### 2.3 é…å°æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PAIRING FLOW                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  [Hub Admin]                    [Station PWA]                   â”‚
â”‚       â”‚                              â”‚                          â”‚
â”‚       â”‚  1. Create Station           â”‚                          â”‚
â”‚       â”‚  2. Generate Pairing QR      â”‚                          â”‚
â”‚       â”‚     (code expires 10min)     â”‚                          â”‚
â”‚       â”‚                              â”‚                          â”‚
â”‚       â”‚         â”€â”€â”€ QR Code â”€â”€â”€â–º     â”‚                          â”‚
â”‚       â”‚                              â”‚                          â”‚
â”‚       â”‚                         3. Scan QR                      â”‚
â”‚       â”‚                         4. Extract hub_url + code       â”‚
â”‚       â”‚                              â”‚                          â”‚
â”‚       â”‚     â—„â”€â”€â”€ HTTPS POST â”€â”€â”€â”€     â”‚                          â”‚
â”‚       â”‚     /api/stations/pair       â”‚                          â”‚
â”‚       â”‚     { code, device_info }    â”‚                          â”‚
â”‚       â”‚                              â”‚                          â”‚
â”‚       â”‚  5. Validate code            â”‚                          â”‚
â”‚       â”‚  6. Generate station_secret  â”‚                          â”‚
â”‚       â”‚  7. Return config bundle     â”‚                          â”‚
â”‚       â”‚                              â”‚                          â”‚
â”‚       â”‚     â”€â”€â”€ Config Bundle â”€â”€â”€â–º   â”‚                          â”‚
â”‚       â”‚     {                        â”‚                          â”‚
â”‚       â”‚       station_secret,        â”‚                          â”‚
â”‚       â”‚       hub_public_key,        â”‚                          â”‚
â”‚       â”‚       hub_encryption_key,    â”‚                          â”‚
â”‚       â”‚       prescriber_certs[]     â”‚  (Pharmacy only)         â”‚
â”‚       â”‚     }                        â”‚                          â”‚
â”‚       â”‚                              â”‚                          â”‚
â”‚       â”‚                         8. Store securely               â”‚
â”‚       â”‚                         9. Ready!                       â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 é›¢ç·šé…å°å‚™æ´ (XSDEP USB)

è‹¥ç„¡ç¶²è·¯é€£ç·šï¼ŒHub å¯åŒ¯å‡ºç°½ç« è¨­å®šæª”ï¼š

```json
{
  "type": "STATION_CONFIG_OFFLINE",
  "ver": 1,
  "station_id": "STATION-PARK",
  "station_type": "SUPPLY",
  "config": {
    "station_secret": "base64...",
    "hub_public_key": "base64...",
    "hub_encryption_key": "base64..."
  },
  "issued_at": 1734912000,
  "expires_at": 1735516800,           // 7 days
  "signature": "Hub_Ed25519_Signature"
}
```

Station é©—è­‰ç°½ç« å¾ŒåŒ¯å…¥è¨­å®šã€‚

### 2.5 Hub Admin UI (é…å°ä»‹é¢)

Hub ç®¡ç†å“¡å¯é€é Admin Console ç”¢ç”Ÿ Station/Pharmacy é…å°ç¢¼ï¼š

**å…¥å£**: ç³»çµ±é¸å–® â†’ ã€ŒStation é…å°ã€

**UI åŠŸèƒ½**:
1. **ç«™é»é¡å‹é¸æ“‡**: ç‰©è³‡ç«™ (SUPPLY) æˆ– è—¥å±€ç«™ (PHARMACY)
2. **ç«™é» ID è¼¸å…¥**: ä¾‹å¦‚ `STATION-001`
3. **ç«™é»åç¨±è¼¸å…¥**: ä¾‹å¦‚ã€Œä¸€æ¨“ç‰©è³‡ç«™ã€
4. **ç”¢ç”Ÿé…å°ç¢¼**: 6 å­—å…ƒè‹±æ•¸å­—ç¢¼ï¼Œæœ‰æ•ˆæœŸ 10 åˆ†é˜
5. **QR Code é¡¯ç¤º**: åŒ…å« `STATION_PAIR_INVITE` payload
6. **å·²é…å°ç«™é»åˆ—è¡¨**: é¡¯ç¤ºæ‰€æœ‰å·²å®Œæˆé…å°çš„ç«™é»

**API ç«¯é»**:
- `POST /api/satellite/stations/generate-pairing` - ç”¢ç”Ÿé…å°ç¢¼
- `POST /api/satellite/stations/pair` - å®Œæˆé…å°
- `GET /api/satellite/stations` - åˆ—å‡ºå·²é…å°ç«™é»

---

## 3. ä½¿ç”¨è€…æµç¨‹ (User Flows)

### 3.1 é¦–æ¬¡ä½¿ç”¨å¼•å° (Onboarding)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: Welcome                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚         [xIRS Station Icon]                                     â”‚
â”‚                                                                  â”‚
â”‚         æ­¡è¿ä½¿ç”¨ xIRS ç‰©è³‡ç«™                                     â”‚
â”‚         (æˆ–ã€Œè—¥å±€å·¥ä½œç«™ã€for /pharmacy/)                        â”‚
â”‚                                                                  â”‚
â”‚    é€™æ˜¯ä¸€å€‹é›¢ç·šå„ªå…ˆçš„ç‰©è³‡ç®¡ç†å·¥å…·ï¼Œ                               â”‚
â”‚    ç”¨æ–¼ç½é›£æ™‚æœŸçš„åˆ†ç«™ç‰©è³‡ç™¼æ”¾ã€‚                                   â”‚
â”‚                                                                  â”‚
â”‚         [é–‹å§‹è¨­å®š]                                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: Pair with Hub                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚    è«‹æƒæ Hub æä¾›çš„é…å° QR Code                                 â”‚
â”‚                                                                  â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚         â”‚   [Camera]      â”‚                                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                                                                  â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€ æˆ– â”€â”€â”€â”€â”€â”€â”€                                           â”‚
â”‚                                                                  â”‚
â”‚    Hub URL:  [________________]                                 â”‚
â”‚    é…å°ç¢¼:   [______]                                           â”‚
â”‚                                                                  â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€ å®Œå…¨é›¢ç·šï¼Ÿ â”€â”€â”€â”€â”€â”€â”€                                   â”‚
â”‚                                                                  â”‚
â”‚    [åŒ¯å…¥é›¢ç·šè¨­å®šæª” (.json)]                                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: Ready                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚         âœ“ é…å°æˆåŠŸï¼                                            â”‚
â”‚                                                                  â”‚
â”‚    Station: å…¬åœ’ç«™ (STATION-PARK)                               â”‚
â”‚    Hub: ç¤¾å€æ´»å‹•ä¸­å¿ƒ                                             â”‚
â”‚    é¡å‹: ç‰©è³‡ç«™                                                  â”‚
â”‚                                                                  â”‚
â”‚         [é–‹å§‹ä½¿ç”¨]                                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Supply Station å„€è¡¨æ¿ (`/station/`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â‰¡]              å…¬åœ’ç«™ - ç‰©è³‡ç«™            [ğŸ”” 2] [âš™ï¸]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚              â”‚
â”‚  â”‚   ğŸ“¥ æ”¶è²¨           â”‚  â”‚   ğŸ“¤ ç™¼æ”¾           â”‚              â”‚
â”‚  â”‚   Receive           â”‚  â”‚   Dispense          â”‚              â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚              â”‚
â”‚  â”‚   æƒæ Runner       â”‚  â”‚   ç™¼æ”¾ç‰©è³‡çµ¦        â”‚              â”‚
â”‚  â”‚   å¸¶ä¾†çš„è£œçµ¦æ¸…å–®    â”‚  â”‚   é¿é›£è€…            â”‚              â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚              â”‚
â”‚  â”‚   ğŸ“‹ å›å ±           â”‚  â”‚   ğŸ‘¤ ç™»è¨˜           â”‚              â”‚
â”‚  â”‚   Report            â”‚  â”‚   Register          â”‚              â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚              â”‚
â”‚  â”‚   ç”¢ç”Ÿå ±å‘Šçµ¦        â”‚  â”‚   ç™»è¨˜æ–°æŠµé”        â”‚              â”‚
â”‚  â”‚   Runner å¸¶å›       â”‚  â”‚   çš„é¿é›£è€…          â”‚              â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚    12    â”‚ â”‚    45    â”‚ â”‚    3     â”‚                        â”‚
â”‚  â”‚  ç‰©è³‡å“é … â”‚ â”‚  ç™»è¨˜äººæ•¸ â”‚ â”‚  å¾…å›å ±  â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ  é¦–é ]    [ğŸ“¦ åº«å­˜]    [ğŸ“‹ æ­·å²]    [âš™ï¸ è¨­å®š]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 Pharmacy Station å„€è¡¨æ¿ (`/pharmacy/`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â‰¡]              å…¬åœ’è—¥å±€ - è—¥å±€ç«™          [ğŸ”” 5] [âš™ï¸]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚              â”‚
â”‚  â”‚   ğŸ“· æƒæè™•æ–¹       â”‚  â”‚   ğŸ’Š ç™¼è—¥ä½‡åˆ—       â”‚              â”‚
â”‚  â”‚   Scan Rx           â”‚  â”‚   Dispense Queue    â”‚              â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚              â”‚
â”‚  â”‚   æƒæé†«å¸«é–‹ç«‹çš„    â”‚  â”‚   å¾…ç™¼è—¥: 8 ç­†      â”‚              â”‚
â”‚  â”‚   è™•æ–¹ QR Code      â”‚  â”‚   ç®¡åˆ¶è—¥: 2 ç­†      â”‚              â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚              â”‚
â”‚  â”‚   ğŸ“¥ é€²è—¥           â”‚  â”‚   ğŸ“‹ å›å ±           â”‚              â”‚
â”‚  â”‚   Stock             â”‚  â”‚   Report            â”‚              â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚              â”‚
â”‚  â”‚   æƒæè—¥å“è£œçµ¦      â”‚  â”‚   åŒæ­¥ç™¼è—¥ç´€éŒ„      â”‚              â”‚
â”‚  â”‚   æ¸…å–®              â”‚  â”‚   è‡³ Hub            â”‚              â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚    28    â”‚ â”‚    8     â”‚ â”‚    12    â”‚                        â”‚
â”‚  â”‚  è—¥å“å“é … â”‚ â”‚  å¾…ç™¼è—¥  â”‚ â”‚  å¾…å›å ±  â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ  é¦–é ]    [ğŸ’Š è—¥å“]    [ğŸ“‹ ç¨½æ ¸]    [âš™ï¸ è¨­å®š]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. æ ¸å¿ƒåŠŸèƒ½è¦æ ¼ (Core Specifications)

### 4.1 ç‰©æµå¾ªç’° (Logistics Loop) - å…±ç”¨

**æ”¶è²¨ (Receive)**:
1. æƒæ `RESTOCK_MANIFEST` QR
2. é©—è­‰ Ed25519 ç°½ç« 
3. æª¢æŸ¥ `manifest_id` å»é‡
4. é¡¯ç¤ºç‰©è³‡æ¸…å–®ä¾›ç¢ºèª
5. ç¢ºèªå¾Œæ›´æ–° `local_inventory`
6. è¨˜éŒ„ `RECEIVE` action

**ç™¼æ”¾ (Dispense)**:
1. é¸æ“‡ç‰©è³‡ + æ•¸é‡
2. å¯é¸ï¼šæƒæ/è¼¸å…¥é ˜å–äºº ID
3. æ‰£æ¸› `local_inventory`
4. è¨˜éŒ„ `DISPENSE` action

**å›å ± (Report)**:
1. å½™æ•´å¾…åŒæ­¥ `actions`
2. æ‰“åŒ… `REPORT_PACKET`
3. SealedBox åŠ å¯† + HMAC
4. åˆ†æ®µç”¢ç”Ÿ QR Code
5. Runner æƒæå®Œæˆå¾Œæ¨™è¨˜ "in transit"

### 4.2 è‡¨åºŠå¾ªç’° (Clinical Loop) - Pharmacy Only

**æ¥æ”¶è™•æ–¹ (Rx Ingest)**:
1. æƒæ Doctor PWA çš„ Rx QR
2. é©—è­‰é†«å¸«ç°½ç«  (ä½¿ç”¨æœ¬åœ° `PRESCRIBER_CERT`)
3. æª¢æŸ¥ `rx_id` å»é‡ (Replay Protection)
4. å±•ç¤ºè™•æ–¹å…§å®¹:
   - è—¥å“æ¸…å–®
   - `patient_ref` (é¡¯ç¤ºæœ« 4 ç¢¼)
   - é†«å¸« ID + åç¨±
5. åŠ å…¥ç™¼è—¥ä½‡åˆ—

**ç™¼è—¥ (Dispense Rx)**:
1. å¾ä½‡åˆ—é¸æ“‡è™•æ–¹
2. ç¢ºèª/èª¿æ•´è—¥å“ (æ›¿ä»£ç”¨è—¥)
3. ç®¡åˆ¶è—¥éœ€å¡«å¯«è¦‹è­‰äºº
4. æäº¤:
   - æ‰£æ¸›è—¥å“åº«å­˜
   - ç”¢ç”Ÿ `DISPENSE_RECORD` (Class B, åŠ å¯†)
   - è¨˜éŒ„ç¨½æ ¸è»Œè·¡

### 4.3 è­‰æ›¸æ›´æ–° (Cert Sync)

**å°åŒ…æ ¼å¼ (`CERT_UPDATE`)**:

```json
{
  "type": "CERT_UPDATE",
  "ver": 1,
  "certs": [
    {
      "id": "DOC-001",
      "name": "ç‹å¤§æ˜ é†«å¸«",
      "public_key": "base64_ed25519_pubkey",
      "issued_at": 1734912000,
      "expires_at": 1766448000,
      "revoked": false
    }
  ],
  "issued_at": 1734912000,
  "signature": "Hub_Ed25519_Signature"
}
```

**æ›´æ–°æ©Ÿåˆ¶**:
1. Hub ç”¢ç”Ÿç°½ç« çš„ `CERT_UPDATE` QR
2. Runner å¸¶åˆ° Pharmacy
3. Pharmacy æƒæ â†’ é©—ç°½ â†’ æ›´æ–°æœ¬åœ° `prescribers` store
4. éæœŸ/æ’¤éŠ·çš„æ†‘è­‰è‡ªå‹•ç§»é™¤

---

## 5. æŠ€è¡“å¯¦ä½œ (Technical Implementation)

### 5.1 IndexedDB Schema

**Supply Station (`/station/`)**:

```javascript
const STATION_STORES = {
  config: 'keyval',           // Station config
  inventory: 'keyval',        // code -> { qty, unit, name }
  actions: 'autoIncrement',   // Action log (pending sync)
  manifests: 'keyval',        // Processed manifest IDs
  reports: 'keyval',          // Generated report history
  persons: 'autoIncrement'    // Registered persons
};
```

**Pharmacy Station (`/pharmacy/`)**:

```javascript
const PHARMACY_STORES = {
  ...STATION_STORES,
  prescribers: 'keyval',      // Prescriber certs
  rx_queue: 'autoIncrement',  // Pending Rx to dispense
  rx_history: 'keyval',       // Processed rx_ids (dedupe)
  clinical: 'autoIncrement'   // Encrypted clinical records
};
```

### 5.2 åŠ å¯†å¯¦ä½œ (Web Crypto API)

```javascript
// xirs-crypto.js

class ClinicalEncryption {
  constructor() {
    this.algorithm = { name: 'AES-GCM', length: 256 };
  }

  // Derive key from station_secret
  async deriveKey(stationSecret) {
    const keyMaterial = await crypto.subtle.importKey(
      'raw',
      base64ToArrayBuffer(stationSecret),
      'PBKDF2',
      false,
      ['deriveKey']
    );

    return crypto.subtle.deriveKey(
      {
        name: 'PBKDF2',
        salt: new TextEncoder().encode('xirs-clinical-v1'),
        iterations: 100000,
        hash: 'SHA-256'
      },
      keyMaterial,
      this.algorithm,
      false,
      ['encrypt', 'decrypt']
    );
  }

  // Encrypt Class B data
  async encrypt(data, key) {
    const iv = crypto.getRandomValues(new Uint8Array(12));
    const encoded = new TextEncoder().encode(JSON.stringify(data));

    const ciphertext = await crypto.subtle.encrypt(
      { name: 'AES-GCM', iv },
      key,
      encoded
    );

    return {
      iv: arrayBufferToBase64(iv),
      ciphertext: arrayBufferToBase64(ciphertext)
    };
  }

  // Decrypt Class B data
  async decrypt(encrypted, key) {
    const iv = base64ToArrayBuffer(encrypted.iv);
    const ciphertext = base64ToArrayBuffer(encrypted.ciphertext);

    const decrypted = await crypto.subtle.decrypt(
      { name: 'AES-GCM', iv },
      key,
      ciphertext
    );

    return JSON.parse(new TextDecoder().decode(decrypted));
  }
}
```

### 5.3 è™•æ–¹ QR æ ¼å¼ (Rx QR)

```json
{
  "type": "RX_ORDER",
  "ver": 1,
  "rx_id": "RX-20251222-001",
  "prescriber_id": "DOC-001",
  "patient_ref": "pref_a1b2c3d4e5f6",   // Token only, no name!
  "items": [
    { "code": "AMOX-500", "qty": 21, "dosage": "1# TID x 7D" },
    { "code": "ACET-500", "qty": 10, "dosage": "1# PRN" }
  ],
  "notes_encrypted": "base64...",        // Optional SOAP-Lite (encrypted)
  "issued_at": 1734912000,
  "expires_at": 1735516800,              // 7 days
  "signature": "Prescriber_Ed25519_Sig"
}
```

> **éš±ç§è¦é»**: `patient_ref` æ˜¯ Hub ç”¢ç”Ÿçš„ä¸å¯é€† tokenï¼ŒPharmacy ç„¡æ³•å¾ä¸­æ¨å°å‡ºç—…æ‚£èº«ä»½ã€‚

---

## 6. UI/UX è¦æ ¼ (Design Specifications)

### 6.1 è¨­è¨ˆåŸå‰‡

| åŸå‰‡ | å¯¦ä½œ |
|------|------|
| **ä»»å‹™å°å‘** | å¤§æŒ‰éˆ• + æ¸…æ™°èªªæ˜æ–‡å­— |
| **é›¢ç·šå¯è¦‹** | æ°¸é é¡¯ç¤ºåŒæ­¥ç‹€æ…‹ã€é›¢ç·š banner |
| **é˜²å‘†è¨­è¨ˆ** | ç ´å£æ€§æ“ä½œéœ€ç¢ºèª |
| **æ‰å¹³è¨­è¨ˆ** | Teal + Deep Blueï¼Œç„¡æ¼¸å±¤ |
| **Heroicons** | ç¦æ­¢ä½¿ç”¨ emoji |

### 6.2 è‰²å½©ç³»çµ±

```css
/* Supply Station - Teal */
--station-600: #0d9488;
--station-700: #0f766e;
--station-800: #115e59;

/* Pharmacy Station - Indigo */
--pharmacy-600: #4f46e5;
--pharmacy-700: #4338ca;
--pharmacy-800: #3730a3;

/* Shared */
--accent-600: #1e3a5f;    /* Deep blue */
--success: #10b981;
--warning: #f59e0b;
--error: #ef4444;
```

### 6.3 éš±ç§æ¨¡å¼ Toggle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¨­å®š                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  ğŸ”’ éš±ç§æ¨¡å¼           [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ ON]    â”‚
â”‚                                          â”‚
â”‚  é–‹å•Ÿæ™‚ï¼š                                â”‚
â”‚  â€¢ patient_ref åƒ…é¡¯ç¤ºæœ« 4 ç¢¼             â”‚
â”‚  â€¢ éš±è—æ‰€æœ‰äººå£å­¸è³‡æ–™                    â”‚
â”‚  â€¢ ç™¼è—¥ç´€éŒ„ä¸é¡¯ç¤ºè¨»è¨˜                    â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. API è¦æ ¼ (Backend API)

### 7.1 é…å° API

```
POST /api/stations/pair
Content-Type: application/json

Request:
{
  "pairing_code": "A3X9K2",
  "device_info": {
    "user_agent": "...",
    "platform": "iOS"
  }
}

Response (200):
{
  "station_id": "STATION-PARK",
  "station_type": "SUPPLY",
  "display_name": "å…¬åœ’ç«™",
  "config": {
    "station_secret": "base64...",
    "hub_public_key": "base64...",
    "hub_encryption_key": "base64..."
  },
  "prescriber_certs": []  // Only for PHARMACY type
}

Response (401):
{
  "error": "INVALID_OR_EXPIRED_CODE"
}
```

### 7.2 å ±å‘Šæ¥æ”¶ API

```
POST /api/logistics/reports
Content-Type: application/json

Request:
{
  "station_id": "STATION-PARK",
  "encrypted_payload": "base64_sealedbox...",
  "hmac": "base64..."
}

Response (200):
{
  "packet_id": "PKT-a1b2c3d4",
  "status": "ACCEPTED",
  "actions_processed": 12
}
```

---

## 8. é©—æ”¶æ¨™æº– (Acceptance Criteria)

### 8.1 åŠŸèƒ½é©—æ”¶

| # | æ¸¬è©¦é …ç›® | é æœŸçµæœ |
|---|----------|----------|
| 1 | `/station/` é é¢ç„¡è™•æ–¹ç›¸é—œåŠŸèƒ½ | æ‰¾ä¸åˆ°ã€Œæƒæè™•æ–¹ã€æŒ‰éˆ•æˆ–ä»£ç¢¼ |
| 2 | `/pharmacy/` é é¢ç„¡äººå“¡ç™»è¨˜åŠŸèƒ½ | æ‰¾ä¸åˆ°ã€Œäººå“¡ç™»è¨˜ã€æŒ‰éˆ• |
| 3 | é›¢ç·šé©—è­‰ Rx | é£›èˆªæ¨¡å¼ä¸‹èƒ½é©—è­‰æœ‰æ•ˆ Rx ä¸¦æ‹’çµ•ç„¡æ•ˆç°½ç«  |
| 4 | ç›²å‚³å®‰å…¨ | Runner QR å…§å®¹ç„¡ Hub ç§é‘°ç„¡æ³•è§£è®€ |
| 5 | é…å°æµç¨‹ | æ–°è£ç½® 1 åˆ†é˜å…§å®Œæˆé…å° |

### 8.2 éš±ç§é©—æ”¶

| # | æ¸¬è©¦é …ç›® | é æœŸçµæœ |
|---|----------|----------|
| 1 | Station IndexedDB æª¢æŸ¥ | ç„¡ Class A/B è³‡æ–™ |
| 2 | Pharmacy IndexedDB æª¢æŸ¥ | Class B è³‡æ–™çš†å·²åŠ å¯† |
| 3 | è™•æ–¹ QR æª¢æŸ¥ | ç„¡ç—…æ‚£å§“åï¼Œåƒ…æœ‰ `patient_ref` |
| 4 | Report Packet æª¢æŸ¥ | ç„¡æ˜æ–‡è‡¨åºŠè³‡æ–™ |

---

## 9. å¯¦ä½œå„ªå…ˆåº (Implementation Priority)

### Phase 1: Supply Station Redesign
- [ ] Onboarding flow (Pairing)
- [ ] Task-oriented dashboard
- [ ] Improved receive/dispense UX
- [ ] Visual polish (Teal + Heroicons)

### Phase 2: Pharmacy Station (New)
- [ ] Create `/pharmacy/` PWA
- [ ] Rx scanning + verification
- [ ] Dispense queue
- [ ] Clinical encryption

### Phase 3: Hub Integration
- [ ] Pairing API (`/api/stations/pair`)
- [ ] CERT_UPDATE generation
- [ ] Clinical report ingestion

### Phase 4: Polish
- [ ] Privacy mode toggle
- [ ] Offline config import
- [ ] Error handling & edge cases

---

## 10. é™„éŒ„ (Appendix)

### A. è¡“èªå°ç…§

| Term | ä¸­æ–‡ | èªªæ˜ |
|------|------|------|
| Station | åˆ†ç«™ | é›¢ç·šé‹ä½œçš„ç‰©è³‡ç™¼æ”¾é» |
| Pharmacy | è—¥å±€ç«™ | å…·å‚™è™•æ–¹é©—è­‰èƒ½åŠ›çš„åˆ†ç«™ |
| Hub | æŒ‡æ®ä¸­å¿ƒ | å…·æ¬Šå¨æ€§çš„ä¸­å¤®ä¼ºæœå™¨ |
| Runner | å‚³ä»¤å…µ | ç›²å‚³ QR Code çš„äººå“¡ |
| Manifest | å‡ºè²¨æ¸…å–® | Hub ç°½ç« çš„ç‰©è³‡æ¸…å–® |
| Report | å›å ±å°åŒ… | Station åŠ å¯†çš„å‹•ä½œç´€éŒ„ |
| Rx | è™•æ–¹ | é†«å¸«ç°½ç« çš„è—¥å“è™•æ–¹ |
| patient_ref | ç—…æ‚£ä»£è™Ÿ | ä¸å¯é€†çš„ç—…æ‚£è­˜åˆ¥ token |

### B. ç›¸é—œæ–‡ä»¶

- [xIRS_DISTRIBUTED_LOGISTICS_SPEC_v1.8.md](./xIRS_DISTRIBUTED_LOGISTICS_SPEC_v1.8.md)
- [xIRS_LITE_CPOE_SPEC_v1.0.md](./xIRS_LITE_CPOE_SPEC_v1.0.md)
- [xIRS_ARCHITECTURE_ADJUSTMENTS_v2.md](./xIRS_ARCHITECTURE_ADJUSTMENTS_v2.md)

---

**Document Version**: 2.3
**Created**: 2025-12-22
**Contributors**: Claude, ChatGPT, Gemini
**Status**: Ready for Development
