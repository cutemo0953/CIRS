# Satellite PWA é–‹ç™¼è¦æ ¼æ›¸

> Hub & Spoke æ¶æ§‹ï¼šè®“å¿—å·¥æ‰‹æ©Ÿæˆç‚ºã€Œå‚³ä»¤å…µã€

---

## ğŸ“– æ¶æ§‹æ¦‚å¿µï¼šæŒ‡æ®å®˜èˆ‡å‚³ä»¤å…µ

### æ•…äº‹ç‰ˆèªªæ˜

æƒ³åƒç½å€æ­èµ·äº†ä¸€å€‹**æ•‘ç½ä¸­å¿ƒ**ï¼š

| è§’è‰² | æŠ€è¡“å°æ‡‰ | è·è²¬ |
|------|----------|------|
| **æŒ‡æ®å¸³ç¯· / å¤§ç™½æ¿** | Raspberry Pi (Hub) | å¤§è…¦ã€‚å­˜è³‡æ–™ã€ç™¼ WiFiã€‚å›ºå®šä¸å‹•ã€‚ |
| **æŒ‡æ®å®˜ç›£æ§è¢å¹•** | Admin Dashboard | çœ¼ç›ã€‚çœ‹å ±è¡¨ã€åšè¨­å®šã€‚ |
| **å‚³ä»¤å…µå°ç­†è¨˜æœ¬** | æ‰‹æ©Ÿ PWA (Satellite) | æ‰‹è…³ã€‚åˆ°è™•è·‘ã€æƒ QRã€é»é¸ç™¼æ”¾ã€‚ |
| **ç„¡ç·šé›»** | WiFi (Intranet) | ç¥ç¶“ã€‚é€£çµå¤§è…¦èˆ‡æ‰‹è…³ã€‚ |

### è¨­è¨ˆåŸå‰‡

1. **æ‰‹æ©Ÿä¸å­˜è³‡æ–™** - Satellite åªæ˜¯é™æ§å™¨ï¼Œè³‡æ–™éƒ½åœ¨ Hub
2. **WiFi è‡ªå‹•åŒæ­¥** - 0.1 ç§’è‡ªå‹•åŒæ­¥ï¼Œä¸éœ€æ‰‹å‹•æ“ä½œ
3. **é›¢ç·šæš«å­˜** - æ–·ç¶²æ™‚å…ˆè¨˜åœ¨æ‰‹æ©Ÿï¼Œæ¢å¾©å¾Œè‡ªå‹•è£œå‚³
4. **æ‰‹æ©Ÿå£äº†æ²’é—œä¿‚** - æ›ä¸€æ”¯ç™»å…¥å³å¯ç¹¼çºŒ

### ç‚ºä»€éº¼é€™æ¨£è¨­è¨ˆï¼Ÿ

- **çœéŒ¢**ï¼šå¿—å·¥ç”¨è‡ªå·±æ‰‹æ©Ÿï¼Œä¸ç”¨è²·å¹³æ¿
- **æ•ˆç‡**ï¼šèª°åœ¨ç¾å ´èª°è¼¸å…¥ï¼Œä¸ç”¨è·‘å›æ«ƒå°
- **å®‰å…¨**ï¼šæ‰‹æ©Ÿæ‰äº†è³‡æ–™é‚„åœ¨ Hub è£¡

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹åœ–

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     Raspberry Pi (Hub)          â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚ CIRS:8090 â”‚ MIRS:8000     â”‚  â”‚
                    â”‚  â”‚ ç¤¾å€ç‰©è³‡   â”‚ é†«ç™‚åº«å­˜      â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â”‚         SQLite Database         â”‚
                    â”‚       (Single Source of Truth)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ WiFi / LAN
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚               â”‚               â”‚
              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
              â”‚ Satellite â”‚   â”‚ Satellite â”‚   â”‚ Satellite â”‚
              â”‚  (å¿—å·¥A)   â”‚   â”‚  (å¿—å·¥B)   â”‚   â”‚  (é†«è­·C)   â”‚
              â”‚           â”‚   â”‚           â”‚   â”‚           â”‚
              â”‚ ğŸ“± CIRS   â”‚   â”‚ ğŸ“± CIRS   â”‚   â”‚ ğŸ“± MIRS   â”‚
              â”‚  Mobile   â”‚   â”‚  Mobile   â”‚   â”‚  Mobile   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  é–€å£å ±åˆ°        ç‰©è³‡ç™¼æ”¾        é†«ç™‚å·¡æˆ¿
```

---

## ğŸ“± CIRS Satellite PWA

### ç›®æ¨™ç”¨æˆ¶
- æ”¶å®¹æ‰€å¿—å·¥
- ç‰©è³‡ç™¼æ”¾äººå“¡
- å ±åˆ°ç™»è¨˜äººå“¡

### æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | èªªæ˜ | å„ªå…ˆç´š |
|------|------|--------|
| QR é…å°é€£æ¥ | æƒæ Hub QR Code è‡ªå‹•é€£æ¥ | âœ… Done |
| URL Token é€£æ¥ | å¾ URL è§£æ token è‡ªå‹•ç™»å…¥ | âœ… Done |
| äººå“¡å ±åˆ° | æƒæç½æ°‘ QR/æ‰‹å‹•è¼¸å…¥ | P1 |
| äººå“¡é€€å ´ | æƒæç½æ°‘ QR/æ‰‹å‹•è¼¸å…¥ | P1 |
| ç‰©è³‡ç™¼æ”¾ | æƒæç™¼æ”¾ QR ç¢ºèªé ˜å– | P1 |
| é›¢ç·šæš«å­˜ | æ–·ç¶²æ™‚æš«å­˜æ“ä½œ | âœ… Done |
| è‡ªå‹•åŒæ­¥ | æ¢å¾©é€£ç·šè‡ªå‹•ä¸Šå‚³ | âœ… Done |
| åº«å­˜æŸ¥è©¢ | æŸ¥çœ‹ç›®å‰ç‰©è³‡åº«å­˜ï¼ˆå”¯è®€ï¼‰ | P2 |
| äººå“¡æŸ¥è©¢ | æŸ¥çœ‹åœ¨å ´äººå“¡åå–®ï¼ˆå”¯è®€ï¼‰ | P2 |

### API Endpoints

#### å·²å¯¦ä½œ

```
GET  /api/auth/pairing-qr      # ç”¢ç”Ÿé…å° QR Code (Admin)
GET  /api/auth/pairing-info    # å–å¾—é…å°è³‡è¨Š JSON (Admin)
POST /api/auth/satellite/verify # é©—è­‰ Satellite Token
```

#### å¾…å¯¦ä½œ

```
# äººå“¡æ“ä½œ
POST /api/satellite/checkin     # äººå“¡å ±åˆ°
POST /api/satellite/checkout    # äººå“¡é€€å ´
GET  /api/satellite/persons     # æŸ¥è©¢åœ¨å ´äººå“¡

# ç‰©è³‡æ“ä½œ
POST /api/satellite/dispense    # ç¢ºèªé ˜å–ç‰©è³‡
GET  /api/satellite/inventory   # æŸ¥è©¢åº«å­˜æ‘˜è¦

# åŒæ­¥
POST /api/satellite/sync        # æ‰¹æ¬¡åŒæ­¥é›¢ç·šæ“ä½œ
GET  /api/satellite/status      # å–å¾— Hub ç‹€æ…‹
```

### é›¢ç·šåŒæ­¥ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Satellite PWA                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  User Action                                              â”‚
â”‚       â”‚                                                   â”‚
â”‚       â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Online?    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Action  â”‚â”€â”€â”€â”€ Yes â”€â”€â”€â”€â”€â–¶â”‚ POST to Hub â”‚               â”‚
â”‚  â”‚ Created â”‚               â”‚ immediately â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚       â”‚                                                   â”‚
â”‚       No (Offline)                                        â”‚
â”‚       â”‚                                                   â”‚
â”‚       â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚  â”‚ IndexedDB   â”‚  â—€â”€â”€ Service Worker                     â”‚
â”‚  â”‚ Sync Queue  â”‚      manages queue                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚         â”‚                                                 â”‚
â”‚         â”‚  Network restored                               â”‚
â”‚         â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚  â”‚ Background  â”‚  â”€â”€ POST /api/satellite/sync â”€â”€â–¶ Hub   â”‚
â”‚  â”‚ Sync        â”‚     (batch upload)                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                           â”‚
â”‚  iOS Safari: Manual trigger via postMessage               â”‚
â”‚  Android Chrome: Background Sync API                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®‰å…¨è¨­è¨ˆ

| é …ç›® | è¨­è¨ˆ |
|------|------|
| Token å„²å­˜ | `sessionStorage`ï¼ˆé—œé–‰åˆ†é å³æ¸…é™¤ï¼‰ |
| Token æœ‰æ•ˆæœŸ | 72 å°æ™‚ |
| é€£æ¥ç‹€æ…‹ | `localStorage`ï¼ˆæŒä¹…åŒ–ï¼‰ |
| URL è™•ç† | è§£æå¾Œç«‹å³æ¸…é™¤ `?token=` åƒæ•¸ |
| æ¬Šé™ç¯„åœ | åƒ…é™ satellite ç›¸é—œ API |

### æª”æ¡ˆçµæ§‹

```
frontend/mobile/
â”œâ”€â”€ index.html          # ä¸» PWA æ‡‰ç”¨
â”œâ”€â”€ manifest.json       # PWA manifest
â”œâ”€â”€ service-worker.js   # é›¢ç·šå¿«å– & åŒæ­¥
â””â”€â”€ icons/
    â”œâ”€â”€ icon.svg
    â”œâ”€â”€ icon-72x72.png
    â”œâ”€â”€ icon-96x96.png
    â”œâ”€â”€ icon-128x128.png
    â”œâ”€â”€ icon-144x144.png
    â”œâ”€â”€ icon-152x152.png
    â”œâ”€â”€ icon-192x192.png
    â”œâ”€â”€ icon-384x384.png
    â””â”€â”€ icon-512x512.png
```

---

## ğŸ¥ MIRS Satellite PWA

### ç›®æ¨™ç”¨æˆ¶
- é†«è­·äººå“¡
- è—¥å¸«
- é†«ç™‚å¿—å·¥

### æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | èªªæ˜ | å„ªå…ˆç´š |
|------|------|--------|
| QR é…å°é€£æ¥ | æƒæ Hub QR Code è‡ªå‹•é€£æ¥ | P1 |
| æª¢å‚·åˆ†é¡ | æ›´æ–°å‚·æ‚£ Triage ç‹€æ…‹ | P1 |
| çµ¦è—¥è¨˜éŒ„ | æƒæè—¥å“ QR è¨˜éŒ„çµ¦è—¥ | P1 |
| ç”Ÿå‘½å¾µè±¡ | è¨˜éŒ„ BP/HR/SpO2/Temp | P1 |
| å‚·æ‚£æŸ¥è©¢ | æŸ¥çœ‹å‚·æ‚£æ¸…å–®èˆ‡ç‹€æ…‹ | P2 |
| è—¥å“åº«å­˜ | æŸ¥çœ‹è—¥å“åº«å­˜ï¼ˆå”¯è®€ï¼‰ | P2 |
| é›¢ç·šæš«å­˜ | æ–·ç¶²æ™‚æš«å­˜æ“ä½œ | P1 |

### API Endpointsï¼ˆå»ºè­°ï¼‰

```
# èªè­‰
GET  /api/auth/mirs-pairing-qr    # ç”¢ç”Ÿ MIRS é…å° QR
POST /api/auth/mirs-satellite/verify

# å‚·æ‚£æ“ä½œ
GET  /api/mirs-satellite/patients      # å‚·æ‚£æ¸…å–®
POST /api/mirs-satellite/triage        # æ›´æ–°æª¢å‚·åˆ†é¡
POST /api/mirs-satellite/vitals        # è¨˜éŒ„ç”Ÿå‘½å¾µè±¡

# çµ¦è—¥æ“ä½œ
POST /api/mirs-satellite/medication    # è¨˜éŒ„çµ¦è—¥
GET  /api/mirs-satellite/med-inventory # è—¥å“åº«å­˜

# åŒæ­¥
POST /api/mirs-satellite/sync          # æ‰¹æ¬¡åŒæ­¥
```

### å»ºè­°æª”æ¡ˆçµæ§‹

```
MIRS/
â””â”€â”€ frontend/
    â””â”€â”€ mobile/
        â”œâ”€â”€ index.html
        â”œâ”€â”€ manifest.json
        â”œâ”€â”€ service-worker.js
        â””â”€â”€ icons/
```

### MIRS Satellite æ˜¯å¦éœ€è¦ï¼Ÿ

**å»ºè­°ï¼šPhase 2 å†å¯¦ä½œ**

| è€ƒé‡ | èªªæ˜ |
|------|------|
| ç¾æ³ | MIRS ç›®å‰ä¸»è¦åœ¨å›ºå®šé†«ç™‚ç«™ä½¿ç”¨ |
| éœ€æ±‚ | é†«è­·äººå“¡é€šå¸¸åœ¨å®šé»ï¼Œä¸åƒå¿—å·¥éœ€è¦åˆ°è™•è·‘ |
| å„ªå…ˆç´š | å…ˆå®Œæˆ CIRS Satelliteï¼Œé©—è­‰æ¶æ§‹å¾Œå†è¤‡è£½åˆ° MIRS |
| å…±ç”¨æ€§ | å¯å…±ç”¨ Service Workerã€é›¢ç·šåŒæ­¥é‚è¼¯ |

---

## ğŸ“‹ é–‹ç™¼ä»»å‹™æ¸…å–®

### CIRS Satellite PWA

#### âœ… å·²å®Œæˆ

- [x] Task 1: PWA Foundation
  - [x] manifest.json
  - [x] service-worker.js
  - [x] åŸºæœ¬ UI æ¡†æ¶
  - [x] é›¢ç·šå¿«å–æ©Ÿåˆ¶
  - [x] App icons

- [x] Task 2: Pairing & Auth
  - [x] GET /api/auth/pairing-qr
  - [x] GET /api/auth/pairing-info
  - [x] POST /api/auth/satellite/verify
  - [x] URL token è§£æ
  - [x] sessionStorage å®‰å…¨å„²å­˜

- [x] Task 3: Hub ç«¯ QR é¡¯ç¤º
  - [x] CIRS Frontend æ–°å¢ã€ŒSatellite é…å°ã€æŒ‰éˆ•
  - [x] Modal é¡¯ç¤º QR Code
  - [x] é¡¯ç¤ºé€£æ¥èªªæ˜èˆ‡æ­¥é©Ÿ
  - [x] å¤šèªè¨€æ”¯æ´ (zh-TW, ja)

#### ğŸ”² å¾…é–‹ç™¼

- [ ] Task 4: äººå“¡æ“ä½œ API
  - [ ] POST /api/satellite/checkin
  - [ ] POST /api/satellite/checkout
  - [ ] GET /api/satellite/persons

- [ ] Task 5: ç‰©è³‡æ“ä½œ API
  - [ ] POST /api/satellite/dispense
  - [ ] GET /api/satellite/inventory

- [ ] Task 6: åŒæ­¥æ©Ÿåˆ¶
  - [ ] POST /api/satellite/sync
  - [ ] è¡çªè§£æ±ºç­–ç•¥
  - [ ] åŒæ­¥ç‹€æ…‹å›å ±

- [ ] Task 7: i18n æ”¯æ´
  - [ ] ç¹é«”ä¸­æ–‡
  - [ ] æ—¥æœ¬èª

### MIRS Satellite PWAï¼ˆPhase 2ï¼‰

- [ ] è¤‡è£½ CIRS Satellite æ¶æ§‹
- [ ] èª¿æ•´ API endpoints
- [ ] å¯¦ä½œé†«ç™‚å°ˆç”¨åŠŸèƒ½

---

## âš ï¸ é‡è¦æ±ºç­–è¨˜éŒ„

### 1. QR Code åŒæ­¥ï¼ˆä¸å¯¦ä½œï¼‰

**æ±ºå®š**ï¼šä¸åšã€ŒSatellite ç”¢ç”Ÿ QR çµ¦ Hub æƒã€çš„åŒæ­¥åŠŸèƒ½

**åŸå› **ï¼š
- WiFi è‡ªå‹•åŒæ­¥æ¯” QR Code å¿« 100 å€
- 99% æƒ…æ³ä¸‹ WiFi æœƒæ­£å¸¸é‹ä½œ
- å¦‚æœ WiFi å£äº†ï¼Œé€šå¸¸æœƒé‡é–‹æ©Ÿæˆ–æ› Router

**å‚™æ¡ˆ**ï¼šæœªä¾†å¯åœ¨ã€Œè¨­å®šã€æ·±å±¤é¸å–®åŠ å…¥ã€Œç”¢ç”Ÿå‚™ä»½ QRã€ä½œç‚ºæœ€å¾Œä¿éšª

### 2. Token å„²å­˜ä½ç½®

**æ±ºå®š**ï¼šä½¿ç”¨ `sessionStorage` è€Œé `localStorage`

**åŸå› **ï¼š
- é—œé–‰åˆ†é å³æ¸…é™¤ï¼Œæ›´å®‰å…¨
- é˜²æ­¢ token é•·æœŸæš´éœ²
- é€£æ¥ç‹€æ…‹ç”¨ `localStorage` ä¿æŒæŒä¹…åŒ–

### 3. MIRS Satellite æ™‚ç¨‹

**æ±ºå®š**ï¼šPhase 2 å†å¯¦ä½œ

**åŸå› **ï¼š
- å…ˆé©—è­‰ CIRS Satellite æ¶æ§‹
- é†«è­·äººå“¡ä½¿ç”¨æƒ…å¢ƒä¸åŒ
- å¯å…±ç”¨å·²é–‹ç™¼çš„åŸºç¤å…ƒä»¶

---

## ğŸ“š ç›¸é—œæ–‡ä»¶

- [å¿—å·¥ PWA å®‰è£æŒ‡å—](./volunteer-pwa-guide.md)
- [CIRS é–‹ç™¼è¦æ ¼æ›¸](../CIRS_DEV_SPEC.md)
- [README](../README.md)

---

*Last Updated: 2024-12*
